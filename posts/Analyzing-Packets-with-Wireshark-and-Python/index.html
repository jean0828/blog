<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Analyzing Packets with Wireshark and Python" /><meta property="og:locale" content="en" /><meta name="description" content="Some cases, as a analysts we need to review network packets to find the root cause of an error or incident. for this reason, in this post we’re going to analyze packets using wireshark and see if we can analyze them with Python. For this post I use this pcap file from a course I have taken called “Bootcamp Analista SOC Nivel 1”. It’s a free and excellent course (taugh in spanish) made by DOJO community. for that cap file we´re going to answer those questions: What protocol did it use the port 3942? With Wireshark: in the filter section we can use this query to see the results: 1 udp.port==3942 || tcp.port ==3942 we can observe that in the column called Protocol we see the answer: SSDP. this protocol stands for Simple Service Discovery Protocol. With Python: First, we have to export the pcap file to csv in order to read with pandas module with the use of tshark: 1 !tshark -r &#39;PCAP01.pcapng&#39; -T fields -E header=y -E separator=, -E quote=d -E occurrence=f -e ip.version -e ip.hdr_len -e ip.tos -e ip.id -e ip.flags -e ip.flags.rb -e ip.flags.df -e ip.flags.mf -e ip.frag_offset -e ip.ttl -e ip.proto -e ip.checksum -e ip.src -e ip.dst -e ip.len -e ip.dsfield -e tcp.port -e tcp.srcport -e tcp.dstport -e tcp.seq -e tcp.ack -e tcp.len -e tcp.hdr_len -e tcp.flags -e tcp.flags.fin -e tcp.flags.syn -e tcp.flags.reset -e tcp.flags.push -e tcp.flags.ack -e tcp.flags.urg -e tcp.flags.cwr -e tcp.window_size -e tcp.checksum -e tcp.urgent_pointer -e tcp.options.mss_val -e udp.port -e _ws.col.Protocol -e _ws.col.Info -e dns.qry.name -e dns.resp.type &gt; output.csv Then, we can read it with: 1 df = pd.read_csv(&#39;output.csv&#39;,on_bad_lines=&#39;skip&#39;) In python, the filters are similar to Wireshark but the advantage it’s we can do more with the data. To know what is the name of the protocol with number 3942, we can use this filter: 1 df[(df[&#39;tcp.port&#39;]==3942) | (df[&#39;udp.port&#39;]==3942)][[&#39;_ws.col.Protocol&#39;,&#39;_ws.col.Info&#39;]] What is the IP address of the host that was pinged twice? With Wireshark: In the filter section we should only write: 1 icmp Then observing the info column which packets begin with request. as a result, the answer is 8.8.4.4 With Python: To filter the ICMP protocol we use: 1 df[(df[&#39;_ws.col.Protocol&#39;]==&#39;ICMP&#39;)][[&#39;ip.src&#39;,&#39;ip.dst&#39;,&#39;_ws.col.Info&#39;]] The table shows us a column called _ws.col.Info where we can see the echo request packets and confirm the destination ip address is 8.8.4.4 How many DNS query response packets have been captured? With Wireshark: Here we write in the filter section: 1 dns.resp.type Next, seeing the bottom of the windows to show the number of packets. The answer is 99 packets Using Python: Using the following filter: 1 df[df[&#39;dns.resp.type&#39;].notnull()].count() we confirm that 99 packets is the right answer. What is the source IP address which has sent more packets? Using Wireshark Here, I started to filter with ip address manually. Then, I could observe that 192.168.1.7 has a big part of the percentage Answering this question with python is better because we can automate with better filters and graph. Using python The groupby method can be used to answer this question. 1 df.groupby(by=&#39;ip.src&#39;).count().sort_values(&#39;_ws.col.Protocol&#39;,ascending=False)[&#39;_ws.col.Protocol&#39;].head(5).plot.bar() according to the graph, we can see that the ip address 192.168.1.7 has more packets than the rest. If you want to see my jupyter noteebook, you can see here." /><meta property="og:description" content="Some cases, as a analysts we need to review network packets to find the root cause of an error or incident. for this reason, in this post we’re going to analyze packets using wireshark and see if we can analyze them with Python. For this post I use this pcap file from a course I have taken called “Bootcamp Analista SOC Nivel 1”. It’s a free and excellent course (taugh in spanish) made by DOJO community. for that cap file we´re going to answer those questions: What protocol did it use the port 3942? With Wireshark: in the filter section we can use this query to see the results: 1 udp.port==3942 || tcp.port ==3942 we can observe that in the column called Protocol we see the answer: SSDP. this protocol stands for Simple Service Discovery Protocol. With Python: First, we have to export the pcap file to csv in order to read with pandas module with the use of tshark: 1 !tshark -r &#39;PCAP01.pcapng&#39; -T fields -E header=y -E separator=, -E quote=d -E occurrence=f -e ip.version -e ip.hdr_len -e ip.tos -e ip.id -e ip.flags -e ip.flags.rb -e ip.flags.df -e ip.flags.mf -e ip.frag_offset -e ip.ttl -e ip.proto -e ip.checksum -e ip.src -e ip.dst -e ip.len -e ip.dsfield -e tcp.port -e tcp.srcport -e tcp.dstport -e tcp.seq -e tcp.ack -e tcp.len -e tcp.hdr_len -e tcp.flags -e tcp.flags.fin -e tcp.flags.syn -e tcp.flags.reset -e tcp.flags.push -e tcp.flags.ack -e tcp.flags.urg -e tcp.flags.cwr -e tcp.window_size -e tcp.checksum -e tcp.urgent_pointer -e tcp.options.mss_val -e udp.port -e _ws.col.Protocol -e _ws.col.Info -e dns.qry.name -e dns.resp.type &gt; output.csv Then, we can read it with: 1 df = pd.read_csv(&#39;output.csv&#39;,on_bad_lines=&#39;skip&#39;) In python, the filters are similar to Wireshark but the advantage it’s we can do more with the data. To know what is the name of the protocol with number 3942, we can use this filter: 1 df[(df[&#39;tcp.port&#39;]==3942) | (df[&#39;udp.port&#39;]==3942)][[&#39;_ws.col.Protocol&#39;,&#39;_ws.col.Info&#39;]] What is the IP address of the host that was pinged twice? With Wireshark: In the filter section we should only write: 1 icmp Then observing the info column which packets begin with request. as a result, the answer is 8.8.4.4 With Python: To filter the ICMP protocol we use: 1 df[(df[&#39;_ws.col.Protocol&#39;]==&#39;ICMP&#39;)][[&#39;ip.src&#39;,&#39;ip.dst&#39;,&#39;_ws.col.Info&#39;]] The table shows us a column called _ws.col.Info where we can see the echo request packets and confirm the destination ip address is 8.8.4.4 How many DNS query response packets have been captured? With Wireshark: Here we write in the filter section: 1 dns.resp.type Next, seeing the bottom of the windows to show the number of packets. The answer is 99 packets Using Python: Using the following filter: 1 df[df[&#39;dns.resp.type&#39;].notnull()].count() we confirm that 99 packets is the right answer. What is the source IP address which has sent more packets? Using Wireshark Here, I started to filter with ip address manually. Then, I could observe that 192.168.1.7 has a big part of the percentage Answering this question with python is better because we can automate with better filters and graph. Using python The groupby method can be used to answer this question. 1 df.groupby(by=&#39;ip.src&#39;).count().sort_values(&#39;_ws.col.Protocol&#39;,ascending=False)[&#39;_ws.col.Protocol&#39;].head(5).plot.bar() according to the graph, we can see that the ip address 192.168.1.7 has more packets than the rest. If you want to see my jupyter noteebook, you can see here." /><link rel="canonical" href="https://jean0828.github.io/blog/posts/Analyzing-Packets-with-Wireshark-and-Python/" /><meta property="og:url" content="https://jean0828.github.io/blog/posts/Analyzing-Packets-with-Wireshark-and-Python/" /><meta property="og:site_name" content="Unf0rG1v3n" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-25T03:20:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Analyzing Packets with Wireshark and Python" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-09-25T17:43:39+00:00","datePublished":"2022-09-25T03:20:00+00:00","description":"Some cases, as a analysts we need to review network packets to find the root cause of an error or incident. for this reason, in this post we’re going to analyze packets using wireshark and see if we can analyze them with Python. For this post I use this pcap file from a course I have taken called “Bootcamp Analista SOC Nivel 1”. It’s a free and excellent course (taugh in spanish) made by DOJO community. for that cap file we´re going to answer those questions: What protocol did it use the port 3942? With Wireshark: in the filter section we can use this query to see the results: 1 udp.port==3942 || tcp.port ==3942 we can observe that in the column called Protocol we see the answer: SSDP. this protocol stands for Simple Service Discovery Protocol. With Python: First, we have to export the pcap file to csv in order to read with pandas module with the use of tshark: 1 !tshark -r &#39;PCAP01.pcapng&#39; -T fields -E header=y -E separator=, -E quote=d -E occurrence=f -e ip.version -e ip.hdr_len -e ip.tos -e ip.id -e ip.flags -e ip.flags.rb -e ip.flags.df -e ip.flags.mf -e ip.frag_offset -e ip.ttl -e ip.proto -e ip.checksum -e ip.src -e ip.dst -e ip.len -e ip.dsfield -e tcp.port -e tcp.srcport -e tcp.dstport -e tcp.seq -e tcp.ack -e tcp.len -e tcp.hdr_len -e tcp.flags -e tcp.flags.fin -e tcp.flags.syn -e tcp.flags.reset -e tcp.flags.push -e tcp.flags.ack -e tcp.flags.urg -e tcp.flags.cwr -e tcp.window_size -e tcp.checksum -e tcp.urgent_pointer -e tcp.options.mss_val -e udp.port -e _ws.col.Protocol -e _ws.col.Info -e dns.qry.name -e dns.resp.type &gt; output.csv Then, we can read it with: 1 df = pd.read_csv(&#39;output.csv&#39;,on_bad_lines=&#39;skip&#39;) In python, the filters are similar to Wireshark but the advantage it’s we can do more with the data. To know what is the name of the protocol with number 3942, we can use this filter: 1 df[(df[&#39;tcp.port&#39;]==3942) | (df[&#39;udp.port&#39;]==3942)][[&#39;_ws.col.Protocol&#39;,&#39;_ws.col.Info&#39;]] What is the IP address of the host that was pinged twice? With Wireshark: In the filter section we should only write: 1 icmp Then observing the info column which packets begin with request. as a result, the answer is 8.8.4.4 With Python: To filter the ICMP protocol we use: 1 df[(df[&#39;_ws.col.Protocol&#39;]==&#39;ICMP&#39;)][[&#39;ip.src&#39;,&#39;ip.dst&#39;,&#39;_ws.col.Info&#39;]] The table shows us a column called _ws.col.Info where we can see the echo request packets and confirm the destination ip address is 8.8.4.4 How many DNS query response packets have been captured? With Wireshark: Here we write in the filter section: 1 dns.resp.type Next, seeing the bottom of the windows to show the number of packets. The answer is 99 packets Using Python: Using the following filter: 1 df[df[&#39;dns.resp.type&#39;].notnull()].count() we confirm that 99 packets is the right answer. What is the source IP address which has sent more packets? Using Wireshark Here, I started to filter with ip address manually. Then, I could observe that 192.168.1.7 has a big part of the percentage Answering this question with python is better because we can automate with better filters and graph. Using python The groupby method can be used to answer this question. 1 df.groupby(by=&#39;ip.src&#39;).count().sort_values(&#39;_ws.col.Protocol&#39;,ascending=False)[&#39;_ws.col.Protocol&#39;].head(5).plot.bar() according to the graph, we can see that the ip address 192.168.1.7 has more packets than the rest. If you want to see my jupyter noteebook, you can see here.","headline":"Analyzing Packets with Wireshark and Python","mainEntityOfPage":{"@type":"WebPage","@id":"https://jean0828.github.io/blog/posts/Analyzing-Packets-with-Wireshark-and-Python/"},"url":"https://jean0828.github.io/blog/posts/Analyzing-Packets-with-Wireshark-and-Python/"}</script><title>Analyzing Packets with Wireshark and Python | Unf0rG1v3n</title><link rel="apple-touch-icon" sizes="180x180" href="/blog/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/blog/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/blog/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/blog/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/blog/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Unf0rG1v3n"><meta name="application-name" content="Unf0rG1v3n"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/blog/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/blog/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/blog/" class="mx-auto"> </a></div><div class="site-title"> <a href="/blog/">Unf0rG1v3n</a></div><div class="site-subtitle font-italic">Security engineer</div></div><ul class="w-100"><li class="nav-item"> <a href="/blog/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/blog/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/blog/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/blog/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/blog/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/jean0828" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['jean.santamaria93','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/blog/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/blog/"> Home </a> </span> <span>Analyzing Packets with Wireshark and Python</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Analyzing Packets with Wireshark and Python</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1664076000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Sep 25, 2022 </em> </span> <span> Updated <em class="" data-ts="1664127819" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Sep 25, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/jean0828">Jean Pierre</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="532 words"> <em>2 min</em> read</span></div></div></div><div class="post-content"><p>Some cases, as a analysts we need to review network packets to find the root cause of an error or incident. for this reason, in this post we’re going to analyze packets using wireshark and see if we can analyze them with Python.</p><p>For this post I use <a href="https://github.com/WOSECPA/AnalistaSOC2022/blob/main/Modulo%204/Taller%20de%20Wireshark/PCAP01.pcapng">this pcap file</a> from a course I have taken called “Bootcamp Analista SOC Nivel 1”. It’s a free and excellent course (taugh in spanish) made by DOJO community.</p><p>for that cap file we´re going to answer those questions:</p><h2 id="what-protocol-did-it-use-the-port-3942"><span class="mr-2">What protocol did it use the port 3942?</span><a href="#what-protocol-did-it-use-the-port-3942" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>With Wireshark:</ul><p>in the filter section we can use this query to see the results:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>udp.port==3942 || tcp.port ==3942
</pre></table></code></div></div><p>we can observe that in the column called <em>Protocol</em> we see the answer: SSDP. this protocol stands for <em>Simple Service Discovery Protocol</em>.</p><p><a href="https://i.imgur.com/dTP1b3b.png" class="popup img-link "><img data-src="https://i.imgur.com/dTP1b3b.png" alt="1w" class="lazyload" data-proofer-ignore></a></p><ul><li>With Python:</ul><p>First, we have to export the pcap file to csv in order to read with pandas module with the use of tshark:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> !tshark -r 'PCAP01.pcapng' -T fields -E header=y -E separator=, -E quote=d -E occurrence=f -e ip.version -e ip.hdr_len -e ip.tos -e ip.id -e ip.flags -e ip.flags.rb -e ip.flags.df -e ip.flags.mf -e ip.frag_offset -e ip.ttl -e ip.proto -e ip.checksum -e ip.src -e ip.dst -e ip.len -e ip.dsfield -e tcp.port -e tcp.srcport -e tcp.dstport -e tcp.seq -e tcp.ack -e tcp.len -e tcp.hdr_len -e tcp.flags -e tcp.flags.fin -e tcp.flags.syn -e tcp.flags.reset -e tcp.flags.push -e tcp.flags.ack -e tcp.flags.urg -e tcp.flags.cwr -e tcp.window_size -e tcp.checksum -e tcp.urgent_pointer -e tcp.options.mss_val -e udp.port -e _ws.col.Protocol -e _ws.col.Info -e dns.qry.name -e dns.resp.type &gt; output.csv
</pre></table></code></div></div><p>Then, we can read it with:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>df = pd.read_csv('output.csv',on_bad_lines='skip')
</pre></table></code></div></div><p>In python, the filters are similar to Wireshark but the advantage it’s we can do more with the data.</p><p>To know what is the name of the protocol with number 3942, we can use this filter:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>df[(df['tcp.port']==3942) | (df['udp.port']==3942)][['_ws.col.Protocol','_ws.col.Info']]
</pre></table></code></div></div><p><a href="https://i.imgur.com/FIjzhDj.png" class="popup img-link "><img data-src="https://i.imgur.com/FIjzhDj.png" alt="1p" class="lazyload" data-proofer-ignore></a></p><h2 id="what-is-the-ip-address-of-the-host-that-was-pinged-twice"><span class="mr-2">What is the IP address of the host that was pinged twice?</span><a href="#what-is-the-ip-address-of-the-host-that-was-pinged-twice" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>With Wireshark:</ul><p>In the filter section we should only write:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>icmp
</pre></table></code></div></div><p>Then observing the info column which packets begin with <em>request</em>.</p><p><a href="https://i.imgur.com/etGnkw9.png" class="popup img-link "><img data-src="https://i.imgur.com/etGnkw9.png" alt="2w" class="lazyload" data-proofer-ignore></a></p><p>as a result, the answer is <strong>8.8.4.4</strong></p><ul><li>With Python:</ul><p>To filter the ICMP protocol we use:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>df[(df['_ws.col.Protocol']=='ICMP')][['ip.src','ip.dst','_ws.col.Info']]
</pre></table></code></div></div><p><a href="https://i.imgur.com/LSwvNYp.png" class="popup img-link "><img data-src="https://i.imgur.com/LSwvNYp.png" alt="2p" class="lazyload" data-proofer-ignore></a></p><p>The table shows us a column called <em>_ws.col.Info</em> where we can see the echo request packets and confirm the destination ip address is <strong>8.8.4.4</strong></p><h2 id="how-many-dns-query-response-packets-have-been-captured"><span class="mr-2">How many DNS query response packets have been captured?</span><a href="#how-many-dns-query-response-packets-have-been-captured" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>With Wireshark:</ul><p>Here we write in the filter section:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dns.resp.type
</pre></table></code></div></div><p>Next, seeing the bottom of the windows to show the number of packets.</p><p><a href="https://i.imgur.com/bDDlZMk.png" class="popup img-link "><img data-src="https://i.imgur.com/bDDlZMk.png" alt="3w" class="lazyload" data-proofer-ignore></a></p><p>The answer is <strong>99 packets</strong></p><ul><li>Using Python:</ul><p>Using the following filter:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>df[df['dns.resp.type'].notnull()].count()
</pre></table></code></div></div><p><a href="https://i.imgur.com/IiNuBaH.png" class="popup img-link "><img data-src="https://i.imgur.com/IiNuBaH.png" alt="3p" class="lazyload" data-proofer-ignore></a></p><p>we confirm that <strong>99 packets</strong> is the right answer.</p><h2 id="what-is-the-source-ip-address-which-has-sent-more-packets"><span class="mr-2">What is the source IP address which has sent more packets?</span><a href="#what-is-the-source-ip-address-which-has-sent-more-packets" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>Using Wireshark</ul><p>Here, I started to filter with ip address manually. Then, I could observe that <em>192.168.1.7</em> has a big part of the percentage</p><p><a href="https://i.imgur.com/Cmd69bo.png" class="popup img-link "><img data-src="https://i.imgur.com/Cmd69bo.png" alt="4w" class="lazyload" data-proofer-ignore></a></p><p>Answering this question with python is better because we can automate with better filters and graph.</p><ul><li>Using python</ul><p>The groupby method can be used to answer this question.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>df.groupby(by='ip.src').count().sort_values('_ws.col.Protocol',ascending=False)['_ws.col.Protocol'].head(5).plot.bar()
</pre></table></code></div></div><p><a href="https://i.imgur.com/YQf8Y7M.png" class="popup img-link "><img data-src="https://i.imgur.com/YQf8Y7M.png" alt="4p" class="lazyload" data-proofer-ignore></a></p><p>according to the graph, we can see that the ip address <strong>192.168.1.7</strong> has more packets than the rest.</p><p>If you want to see my jupyter noteebook, you can see <a href="https://github.com/jean0828/Analying-packets-with-Python/blob/main/Analyzing_pcap_files_with_python.ipynb">here</a>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/blog/categories/python/'>python</a>, <a href='/blog/categories/wireshark/'>wireshark</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/blog/tags/wireshark/" class="post-tag no-text-decoration" >wireshark</a> <a href="/blog/tags/security/" class="post-tag no-text-decoration" >security</a> <a href="/blog/tags/python/" class="post-tag no-text-decoration" >python</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Analyzing%20Packets%20with%20Wireshark%20and%20Python%20-%20Unf0rG1v3n&url=https%3A%2F%2Fjean0828.github.io%2Fblog%2Fposts%2FAnalyzing-Packets-with-Wireshark-and-Python%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Analyzing%20Packets%20with%20Wireshark%20and%20Python%20-%20Unf0rG1v3n&u=https%3A%2F%2Fjean0828.github.io%2Fblog%2Fposts%2FAnalyzing-Packets-with-Wireshark-and-Python%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fjean0828.github.io%2Fblog%2Fposts%2FAnalyzing-Packets-with-Wireshark-and-Python%2F&text=Analyzing%20Packets%20with%20Wireshark%20and%20Python%20-%20Unf0rG1v3n" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/blog/posts/LDAP-Monitoring-with-AMA-and-Microsoft-Sentinel/">LDAP Monitoring with AMA and Microsoft Sentinel</a><li><a href="/blog/posts/Deploying-a-Cloud-Environment-for-DevSecops/">Deploying a Cloud Environment for DevSecops</a><li><a href="/blog/posts/Analyzing-Packets-with-Wireshark-and-Python/">Analyzing Packets with Wireshark and Python</a><li><a href="/blog/posts/Administracion-de-cuentas-locales-en-el-Directorio-Activo-con-LAPS/">(ESP) Administracion de cuentas locales en el Directorio Activo con LAPS</a><li><a href="/blog/posts/Monitoring-Powershell-commands-with-Elastic-Stack/">Monitoring Powershell commands with Elastic Stack</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/blog/tags/sentinel/">sentinel</a> <a class="post-tag" href="/blog/tags/siem/">siem</a> <a class="post-tag" href="/blog/tags/active-directory/">active directory</a> <a class="post-tag" href="/blog/tags/windows/">windows</a> <a class="post-tag" href="/blog/tags/azure/">azure</a> <a class="post-tag" href="/blog/tags/devsecops/">devsecops</a> <a class="post-tag" href="/blog/tags/elastic/">elastic</a> <a class="post-tag" href="/blog/tags/google-cloud/">google cloud</a> <a class="post-tag" href="/blog/tags/jenkins/">jenkins</a> <a class="post-tag" href="/blog/tags/kubernetes/">kubernetes</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/blog/posts/LDAP-Monitoring-with-AMA-and-Microsoft-Sentinel/"><div class="card-body"> <em class="small" data-ts="1692795600" data-df="ll" > Aug 23, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>LDAP Monitoring with AMA and Microsoft Sentinel</h3><div class="text-muted small"><p> According to Microsoft. LDAP is “an application protocol for working with various directory services. Directory services, such as Active Directory, store user and account information, and security ...</p></div></div></a></div><div class="card"> <a href="/blog/posts/Adding-the-Docker-Build-and-Publish-Stage-in-a-Pipeline/"><div class="card-body"> <em class="small" data-ts="1680661200" data-df="ll" > Apr 5, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Adding the Docker Build and Publish Stage in a Pipeline</h3><div class="text-muted small"><p> This is part from the course of Linux Foundation called Implementing DevSecOps and it’s given by initcron. In a development environment, you can build an image with Docker. However, in a Continuou...</p></div></div></a></div><div class="card"> <a href="/blog/posts/Deploying-a-Cloud-Environment-for-DevSecops/"><div class="card-body"> <em class="small" data-ts="1677554400" data-df="ll" > Feb 28, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Deploying a Cloud Environment for DevSecops</h3><div class="text-muted small"><p> For this case, we are going to use Google Cloud. There, a Kubernetes cluster will be created, Linux environment for development will be also created, and Jenkins will be deployed within Kubernetes....</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/blog/posts/Deploying-Wazuh-in-a-home-lab/" class="btn btn-outline-primary" prompt="Older"><p>Deploying Wazuh in a home lab</p></a> <a href="/blog/posts/Deploying-a-Cloud-Environment-for-DevSecops/" class="btn btn-outline-primary" prompt="Newer"><p>Deploying a Cloud Environment for DevSecops</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/blog/tags/sentinel/">sentinel</a> <a class="post-tag" href="/blog/tags/siem/">siem</a> <a class="post-tag" href="/blog/tags/active-directory/">active directory</a> <a class="post-tag" href="/blog/tags/windows/">windows</a> <a class="post-tag" href="/blog/tags/azure/">azure</a> <a class="post-tag" href="/blog/tags/devsecops/">devsecops</a> <a class="post-tag" href="/blog/tags/elastic/">elastic</a> <a class="post-tag" href="/blog/tags/google-cloud/">google cloud</a> <a class="post-tag" href="/blog/tags/jenkins/">jenkins</a> <a class="post-tag" href="/blog/tags/kubernetes/">kubernetes</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/jean0828">Jean Pierre</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/blog/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/blog/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/blog/unregister.js"></script>
